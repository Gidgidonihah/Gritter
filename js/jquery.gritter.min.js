/*
 * Gritter for jQuery
 * http://www.boedesign.com/
 *
 * Copyright (c) 2009 Jordan Boesch
 * Dual licensed under the MIT and GPL licenses.
 *
 * Forked:
 * Date: April 7, 2011
 * https://github.com/Gidgidonihah/Gritter
 */(function(a){a.gritter={};a.gritter.options={fade_in_speed:"medium",fade_out_speed:1e3,time:6e3};a.gritter.add=function(a){try{return b.add(a||{})}catch(c){var d="Gritter Error: "+c;typeof console!="undefined"&&console.error?console.error(d,a):window.alert(d)}};a.gritter.remove=function(a,c){b.removeSpecific(a,c||{})};a.gritter.removeAll=function(a){b.stop(a||{})};a.gritter.resize=function(b,c){var d=parseInt(b.parent().css("top"),10),e=parseInt(b.parent().css("bottom"),10),f=(d?d:0)+(e?e:0);if(b.outerHeight()>a(window).height()-f){c||(c={});c.addition||(c.addition=10);c.speed||(c.speed=25);var g=b.parent(),h=b.parent().width()+c.addition,i=parseInt(b.parent().css("left"),10),j=parseInt(b.parent().css("right"),10),k=(i?i:0)+(j?j:0);h<a(window).width()-k&&g.animate({width:g.width()+c.addition},c.speed,function(){a.gritter.resize(b,c)})}};var b={fade_in_speed:"",fade_out_speed:"",time:"",_custom_timer:0,_item_count:0,_is_setup:0,_tpl_close:'<div class="gritter-close">x</div>',_tpl_item:'<div id="gritter-item-[[number]]" class="gritter-item-wrapper [[item_class]]" style="display:none"><div class="gritter-item [[class_name]]">[[image]]<span class="gritter-title">[[username]]</span><p>[[text]]</p></div></div>',_tpl_wrap:'<div id="gritter-notice-wrapper"></div>',add:function(c){if(!c.text)throw"You need at least one param, the text of the notification";this._is_setup||this._runSetup();var d=c.title,e=c.text,f=c.image||"",g=c.sticky||!1,h=c.hide_close||!1,i=c.class_name||"",j=c.time||"";this._verifyWrapper();this._item_count++;var k=this._item_count,l=this._tpl_item;a(["before_open","after_open","before_close","after_close"]).each(function(d,e){b["_"+e+"_"+k]=a.isFunction(c[e])?c[e]:function(){}});this._custom_timer=0;j&&(this._custom_timer=j);var m=f!==""?'<img src="'+f+'" class="gritter-image" />':"",n=f!==""?"gritter-with-image":"gritter-without-image";l=this._str_replace(["[[username]]","[[text]]","[[image]]","[[number]]","[[class_name]]","[[item_class]]"],[d,e,m,this._item_count,n,i],l);d||(l=l.replace(/<span class="gritter-title"><\/span>/,""));this["_before_open_"+k]();a("#gritter-notice-wrapper").append(l);var o=a("#gritter-item-"+this._item_count);o.fadeIn(this.fade_in_speed,function(){b["_after_open_"+k](a(this))});g||this._setFadeTimer(o,k);a(o).bind("mouseenter mouseleave",function(c){c.type==="mouseenter"?g||b._restoreItemIfFading(a(this),k):g||b._setFadeTimer(a(this),k);b._hoverState(a(this),c.type,h)});return k},_countRemoveWrapper:function(b,c){c.remove();this["_after_close_"+b](c);a(".gritter-item-wrapper").length===0&&a("#gritter-notice-wrapper").remove()},_fade:function(a,c,d,e){var f=d||{},g=typeof f.fade!="undefined"?f.fade:!0,h=f.speed||this.fade_out_speed;if(e){this["_before_close_"+c](a);a.unbind("mouseenter mouseleave")}g?a.animate({opacity:0},h,function(){a.animate({height:0},300,function(){b._countRemoveWrapper(c,a)})}):this._countRemoveWrapper(c,a)},_hoverState:function(a,c,d){if(c==="mouseenter"){a.addClass("hover");if(!d){var e=a.find(".gritter-item");e.prepend(this._tpl_close);a.find(".gritter-close").click(function(){var c=a.attr("id").split("-")[2];b.removeSpecific(c,{},a,!0)})}}else{a.removeClass("hover");a.find(".gritter-close").remove()}},removeSpecific:function(b,c,d,e){var f=d||a("#gritter-item-"+b);this._fade(f,b,c||{},e)},_restoreItemIfFading:function(a,b){clearTimeout(this["_int_id_"+b]);a.stop().css({opacity:""})},_runSetup:function(){for(var b in a.gritter.options)a.gritter.options.hasOwnProperty(b)&&(this[b]=a.gritter.options[b]);this._is_setup=1},_setFadeTimer:function(a,c){var d=this._custom_timer?this._custom_timer:this.time;this._isVisible(a)?this["_int_id_"+c]=setTimeout(function(){b._fade(a,c)},d):this["_int_id_"+c]=setTimeout(function(){b._setFadeTimer(a,c)},parseInt(d/2,10))},_isVisible:function(b){var c={left:a(window).scrollLeft(),top:a(window).scrollTop(),right:a(window).width(),bottom:a(window).height()},d={left:b.offset().left,top:b.offset().top,right:b.offset().left+b.outerWidth(),bottom:b.offset().top+b.outerHeight()};return c.left<=d.left&&c.right>=d.right&&c.top<=d.top&&c.bottom>=d.bottom?!0:!1},stop:function(b){var c=a.isFunction(b.before_close)?b.before_close:function(){},d=a.isFunction(b.after_close)?b.after_close:function(){},e=a("#gritter-notice-wrapper");c(e);e.fadeOut(function(){a(this).remove();d()})},_str_replace:function(a,b,c,d){var e=0,f=0,g="",h="",i=0,j=0,k=[].concat(a),l=[].concat(b),m=c,n=l instanceof Array,o=m instanceof Array;m=[].concat(m);d&&(this.window[d]=0);for(e=0,i=m.length;e<i;e++){if(m[e]==="")continue;for(f=0,j=k.length;f<j;f++){g=m[e]+"";h=n?l[f]!==undefined?l[f]:"":l[0];m[e]=g.split(k[f]).join(h);d&&m[e]!==g&&(this.window[d]+=(g.length-m[e].length)/k[f].length)}}return o?m:m[0]},_verifyWrapper:function(){a("#gritter-notice-wrapper").length===0&&a("body").append(this._tpl_wrap)}}})(jQuery);